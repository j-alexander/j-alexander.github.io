---
layout: post
title: "Evaluate JsonPath Queries using FSharp.Data"
date: 2016-12-15
comments: false
publish: false
---
<h2>Objective</h2>
<p><a href="http://fsharp.org/about/index.html">F#</a> has been characterized as a modern programming language
well-suited to data-rich analytical problems.
In this language, interacting with diverse datasets from event streams, web services, and databases
is further simplified with the open-source <a href="http://fsharp.github.io/FSharp.Data/">FSharp.Data</a>
library.</p>
<p>Many of these real-world documents are hierarchically structured in Json and Xml.
When designing reusable applications and algorithms in this space, it becomes <em>very important</em> to
be able to extract subsets of data using custom queries.</p>
<p>For <a href="https://en.wikipedia.org/wiki/XML">Xml</a>, <a href="http://www.w3schools.com/xml/xml_xpath.asp">XPATH</a> is
a well established tool for describing specific elements within a document.</p>
<p>A similar mechanism exists for Json, called <strong><a href="http://goessner.net/articles/JsonPath/">JsonPath</a></strong>.</p>
<p>Using JsonPath with F# typically involves converting data to
<a href="http://www.newtonsoft.com/json/help/html/QueryJsonSelectToken.htm">Newtonsoft.Json</a>'s <code>JObject</code>
type and invoking <code>SelectToken</code>.  However, FSharp.Data has an elegant and functional representation
of <a href="http://fsharp.github.io/FSharp.Data/reference/fsharp-data-jsonvalue.html">JsonValue</a>s that is
very widely used.</p>
<p>In this article, I describe <em>one possible way</em> to directly query subsets of a <code>JsonValue</code> document
without converting your entire dataset to perform some extraction.</p>
<h2>Dependencies</h2>
<ol>
<li>
<p><em>FSharp.Data</em> from <a href="https://www.nuget.org/packages/newtonsoft.json/">NuGet</a>, or using <a href="https://fsprojects.github.io/Paket/">Paket</a>:</p>
<table class="pre"><tr><td class="snippet"><pre class="fssnip"><code lang="powershell">./.paket/paket.exe add nuget FSharp.Data project MyProject
</code></pre></td></tr></table>
</li>
<li><p><em>Reference</em> and open the FSharp.Data library:</p></li>
</ol>
<pre class="fssnip highlighted"><code lang="fsharp"><span class="prep">#r</span> <span class="s">&quot;packages/FSharp.Data/lib/net40/FSharp.Data.dll&quot;</span>
<span class="k">open</span> <span onmouseout="hideTip(event, 'fs4', 7)" onmouseover="showTip(event, 'fs4', 7)" class="i">FSharp</span><span class="o">.</span><span onmouseout="hideTip(event, 'fs5', 8)" onmouseover="showTip(event, 'fs5', 8)" class="i">Data</span>
</code></pre>
<h2>Query</h2>
<p>Given an arbitrary JsonPath query string, we want to derive a structured representation of
that query.</p>
<pre class="fssnip highlighted"><code lang="fsharp">    <span class="k">type</span> <span onmouseout="hideTip(event, 'fs16', 21)" onmouseover="showTip(event, 'fs16', 21)" class="t">Query</span> <span class="o">=</span> <span onmouseout="hideTip(event, 'fs17', 22)" onmouseover="showTip(event, 'fs17', 22)" class="t">string</span>

    [&lt;<span onmouseout="hideTip(event, 'fs6', 23)" onmouseover="showTip(event, 'fs6', 23)" class="t">CompilationRepresentation</span>(<span onmouseout="hideTip(event, 'fs7', 24)" onmouseover="showTip(event, 'fs7', 24)" class="t">CompilationRepresentationFlags</span><span class="o">.</span><span onmouseout="hideTip(event, 'fs8', 25)" onmouseover="showTip(event, 'fs8', 25)" class="i">ModuleSuffix</span>)&gt;]
    <span class="k">module</span> <span onmouseout="hideTip(event, 'fs16', 26)" onmouseover="showTip(event, 'fs16', 26)" class="t">Query</span> <span class="o">=</span>
</code></pre>
<p>The query consists of a sequence of levels from the root of a json document <code>$</code> separated
by the <code>.</code> character.  Each level refers to a named property or array, and each case is
scoped to match that <code>Exact</code> level, or inclusively <code>Any</code> instances within its subtree.
If a level refers to an array, then a slice, literal index, or wildcard operation (between
<code>[</code> and <code>]</code>) specifies which elements of an array match the query.</p>
<pre class="fssnip highlighted"><code lang="fsharp">        <span class="k">type</span> <span onmouseout="hideTip(event, 'fs18', 27)" onmouseover="showTip(event, 'fs18', 27)" class="t">Levels</span> <span class="o">=</span> <span onmouseout="hideTip(event, 'fs19', 28)" onmouseover="showTip(event, 'fs19', 28)" class="t">Level</span> <span onmouseout="hideTip(event, 'fs20', 29)" onmouseover="showTip(event, 'fs20', 29)" class="t">list</span>
        <span class="k">and</span> <span onmouseout="hideTip(event, 'fs19', 30)" onmouseover="showTip(event, 'fs19', 30)" class="t">Level</span> <span class="o">=</span> <span onmouseout="hideTip(event, 'fs21', 31)" onmouseover="showTip(event, 'fs21', 31)" class="t">Scope</span> <span class="o">*</span> <span onmouseout="hideTip(event, 'fs22', 32)" onmouseover="showTip(event, 'fs22', 32)" class="t">Type</span>
        <span class="k">and</span> <span onmouseout="hideTip(event, 'fs22', 33)" onmouseover="showTip(event, 'fs22', 33)" class="t">Type</span> <span class="o">=</span> <span onmouseout="hideTip(event, 'fs23', 34)" onmouseover="showTip(event, 'fs23', 34)" class="p">Property</span> <span class="k">of</span> <span onmouseout="hideTip(event, 'fs24', 35)" onmouseover="showTip(event, 'fs24', 35)" class="t">Name</span> | <span onmouseout="hideTip(event, 'fs25', 36)" onmouseover="showTip(event, 'fs25', 36)" class="p">Array</span> <span class="k">of</span> <span onmouseout="hideTip(event, 'fs26', 37)" onmouseover="showTip(event, 'fs26', 37)" class="t">Index</span>
        <span class="k">and</span> <span onmouseout="hideTip(event, 'fs21', 38)" onmouseover="showTip(event, 'fs21', 38)" class="t">Scope</span> <span class="o">=</span> <span onmouseout="hideTip(event, 'fs27', 39)" onmouseover="showTip(event, 'fs27', 39)" class="p">Any</span> | <span onmouseout="hideTip(event, 'fs28', 40)" onmouseover="showTip(event, 'fs28', 40)" class="p">Exact</span>
        <span class="k">and</span> <span onmouseout="hideTip(event, 'fs24', 41)" onmouseover="showTip(event, 'fs24', 41)" class="t">Name</span> <span class="o">=</span> <span onmouseout="hideTip(event, 'fs17', 42)" onmouseover="showTip(event, 'fs17', 42)" class="t">string</span>
        <span class="k">and</span> <span onmouseout="hideTip(event, 'fs26', 43)" onmouseover="showTip(event, 'fs26', 43)" class="t">Index</span> <span class="o">=</span>
            | <span onmouseout="hideTip(event, 'fs29', 44)" onmouseover="showTip(event, 'fs29', 44)" class="p">Expression</span> <span class="k">of</span> <span onmouseout="hideTip(event, 'fs17', 45)" onmouseover="showTip(event, 'fs17', 45)" class="t">string</span>
            | <span onmouseout="hideTip(event, 'fs30', 46)" onmouseover="showTip(event, 'fs30', 46)" class="p">Wildcard</span>
            | <span onmouseout="hideTip(event, 'fs31', 47)" onmouseover="showTip(event, 'fs31', 47)" class="p">Slice</span> <span class="k">of</span> <span class="i">start</span><span class="o">:</span><span onmouseout="hideTip(event, 'fs12', 48)" onmouseover="showTip(event, 'fs12', 48)" class="t">int</span> <span onmouseout="hideTip(event, 'fs32', 49)" onmouseover="showTip(event, 'fs32', 49)" class="t">option</span> <span class="o">*</span> <span class="i">finish</span><span class="o">:</span><span onmouseout="hideTip(event, 'fs12', 50)" onmouseover="showTip(event, 'fs12', 50)" class="t">int</span> <span onmouseout="hideTip(event, 'fs32', 51)" onmouseover="showTip(event, 'fs32', 51)" class="t">option</span> <span class="o">*</span> <span class="i">step</span><span class="o">:</span><span onmouseout="hideTip(event, 'fs12', 52)" onmouseover="showTip(event, 'fs12', 52)" class="t">int</span>
            | <span onmouseout="hideTip(event, 'fs33', 53)" onmouseover="showTip(event, 'fs33', 53)" class="p">Literal</span> <span class="k">of</span> <span onmouseout="hideTip(event, 'fs12', 54)" onmouseover="showTip(event, 'fs12', 54)" class="t">int</span> <span onmouseout="hideTip(event, 'fs20', 55)" onmouseover="showTip(event, 'fs20', 55)" class="t">list</span>
</code></pre>
<p>Given a <code>Query</code> string, we should be able to obtain a pattern for the <code>Levels</code>
which can satisfy (or <em>match</em>) that query.</p>
<pre class="fssnip highlighted"><code lang="fsharp">        <span class="k">let</span> <span onmouseout="hideTip(event, 'fs34', 56)" onmouseover="showTip(event, 'fs34', 56)" class="f">levelsFor</span> <span class="o">:</span> <span onmouseout="hideTip(event, 'fs16', 57)" onmouseover="showTip(event, 'fs16', 57)" class="t">Query</span> <span class="k">-&gt;</span> <span onmouseout="hideTip(event, 'fs18', 58)" onmouseover="showTip(event, 'fs18', 58)" class="t">Levels</span> <span class="o">=</span>
            <span class="c">// ... </span>
</code></pre>
<p>For example:</p>
<pre class="fssnip highlighted"><code lang="fsharp">  <span class="c">// any author</span>
  <span class="s">&quot;$..author&quot;</span>   [<span class="i">Any</span>,<span class="i">Property</span>(<span class="s">&quot;author&quot;</span>)]

  <span class="c">// anything at the root of the store</span>
  <span class="s">&quot;$.store.*&quot;</span>   [<span class="i">Exact</span>,<span class="i">Property</span>(<span class="s">&quot;store&quot;</span>);<span class="i">Exact</span>,<span class="i">Property</span>(<span class="s">&quot;*&quot;</span>)]

  <span class="c">// the last book in any collection of books</span>
  <span class="s">&quot;$..book[-1]&quot;</span> [<span class="i">Any</span>,<span class="i">Property</span>(<span class="s">&quot;book&quot;</span>);<span class="i">Exact</span>,<span onmouseout="hideTip(event, 'fs36', 61)" onmouseover="showTip(event, 'fs36', 61)" class="i">Array</span>(<span class="i">Index</span><span class="o">.</span><span onmouseout="hideTip(event, 'fs37', 62)" onmouseover="showTip(event, 'fs37', 62)" class="i">Literal</span>[<span class="o">-</span><span class="n">1</span>])]
</code></pre>
<p>The implementation of this parsing operation is pretty straightforward and can be found
<a href="https://git.io/v1piR">here</a> for the version being discussed in this post.</p>
<h2>Pattern Matching</h2>
<p>Here, <code>Pattern</code> matching on the <code>Query</code> is performed using immutable <a href="https://en.wikipedia.org/wiki/Nondeterministic_finite_automaton">non-deterministic
finite automata</a>.</p>
<pre class="fssnip highlighted"><code lang="fsharp">    <span class="k">module</span> <span class="t">Pattern</span>  <span class="o">=</span>
</code></pre>
<p>An automaton is a specialized kind of state machine.  When given a sequence of
inputs, it has the potential to arrive at some final state indicating acceptance of those
inputs.</p>
<p>Imagine some user interface has a text box that accepts several possible passwords. Each
letter you input will <em>transition</em> your automaton from one state to another (like a
combination lock). If you input the right sequence of letters, you will arrive at a
"password accepted" state and successfully log into the app.</p>
<p>In F#, we can represent this concept as follows:</p>
<h3>Automata</h3>
<p>First, more than <em>one automaton</em> is called <em>automata</em>.</p>
<pre class="fssnip highlighted"><code lang="fsharp">        <span class="k">type</span> <span onmouseout="hideTip(event, 'fs38', 63)" onmouseover="showTip(event, 'fs38', 63)" class="t">Automata</span> <span class="o">=</span> <span onmouseout="hideTip(event, 'fs39', 64)" onmouseover="showTip(event, 'fs39', 64)" class="t">Automaton</span> <span onmouseout="hideTip(event, 'fs20', 65)" onmouseover="showTip(event, 'fs20', 65)" class="t">list</span>
</code></pre>
<ul>
<li><em>Deterministic</em> finite automata will yield exactly one state when given an input.</li>
<li>
<em>Non-deterministic</em> finite automata, on the other hand, may yield more than one. Recall
that our password example would match several possible passwords at once.
</li>
</ul>
<pre class="fssnip highlighted"><code lang="fsharp">        <span class="k">and</span> <span onmouseout="hideTip(event, 'fs39', 66)" onmouseover="showTip(event, 'fs39', 66)" class="t">Automaton</span> <span class="o">=</span> <span onmouseout="hideTip(event, 'fs40', 67)" onmouseover="showTip(event, 'fs40', 67)" class="t">Input</span><span class="k">-&gt;</span><span onmouseout="hideTip(event, 'fs41', 68)" onmouseover="showTip(event, 'fs41', 68)" class="t">State</span> <span onmouseout="hideTip(event, 'fs20', 69)" onmouseover="showTip(event, 'fs20', 69)" class="t">list</span>
</code></pre>
<p>Given some input:</p>
<ul>
<li>
One possible state of the automaton is a <code>Match</code> or <em>acceptance</em> of 
the input.
</li>
<li>
If no match occurs, the automaton must transition to a new state ready to
accept more input.
<ul>
<li>
For example, if you enter the first letter <code>s</code> of a password "secret", the new state of
your automaton must stand ready to <em>accept</em> the character sequence <code>[e;c;r;e;t]</code>.
</li>
</ul>
</li>
</ul>
<p>These automata are <em>immutable</em> in a functional programming sense.  Rather than mutating
some internal state, an input produces derivations.  As a consequence, an input could
produce a <code>Match</code> state, a <em>new</em> <code>Automaton</code>, or even a combination of these.</p>
<pre class="fssnip highlighted"><code lang="fsharp">        <span class="k">and</span> <span onmouseout="hideTip(event, 'fs41', 70)" onmouseover="showTip(event, 'fs41', 70)" class="t">State</span> <span class="o">=</span> <span onmouseout="hideTip(event, 'fs42', 71)" onmouseover="showTip(event, 'fs42', 71)" class="p">Match</span> | <span onmouseout="hideTip(event, 'fs39', 72)" onmouseover="showTip(event, 'fs39', 72)" class="p">Automaton</span> <span class="k">of</span> <span onmouseout="hideTip(event, 'fs39', 73)" onmouseover="showTip(event, 'fs39', 73)" class="t">Automaton</span>
</code></pre>
<p>Finally, since we're matching json documents rather than passwords, your input from an
actual document could be either:</p>
<ul>
<li>a <code>Property</code> of a <a href="https://github.com/fsharp/FSharp.Data/blob/master/src/Json/JsonValue.fs#L38-38">JsonValue.Record</a> with some <code>Name</code>, or</li>
<li>an <code>Array</code> element of a <a href="https://github.com/fsharp/FSharp.Data/blob/master/src/Json/JsonValue.fs#L39-39">JsonValue.Array</a> at some specific index</li>
</ul>
<pre class="fssnip highlighted"><code lang="fsharp">        <span class="k">and</span> <span onmouseout="hideTip(event, 'fs40', 74)" onmouseover="showTip(event, 'fs40', 74)" class="t">Input</span> <span class="o">=</span>
            | <span onmouseout="hideTip(event, 'fs43', 75)" onmouseover="showTip(event, 'fs43', 75)" class="p">Property</span> <span class="k">of</span> <span onmouseout="hideTip(event, 'fs44', 76)" onmouseover="showTip(event, 'fs44', 76)" class="t">Query</span><span class="o">.</span><span onmouseout="hideTip(event, 'fs24', 77)" onmouseover="showTip(event, 'fs24', 77)" class="t">Name</span>
            | <span onmouseout="hideTip(event, 'fs45', 78)" onmouseover="showTip(event, 'fs45', 78)" class="p">Array</span> <span class="k">of</span> <span class="i">index</span><span class="o">:</span><span onmouseout="hideTip(event, 'fs12', 79)" onmouseover="showTip(event, 'fs12', 79)" class="t">int</span><span class="o">*</span><span class="i">length</span><span class="o">:</span><span onmouseout="hideTip(event, 'fs12', 80)" onmouseover="showTip(event, 'fs12', 80)" class="t">int</span>
</code></pre>
<p>Where are the other <code>JsonValue</code> cases? These are <em>values</em> that occur at some path in the
JsonPath query, rather than parts of the path itself.</p>
<p>Given the following example, we might refer to JsonPath "<code>$.x</code>". The value "<code>3</code>" would
be the <em>result</em> of this match.</p>
<table class="pre"><tr><td class="snippet"><pre class="fssnip"><code lang="json">  { "x": 3 }
</code></pre></td></tr></table>
<h3>Example</h3>
<p>Suppose we're given the query "<code>$..book[-2]</code>" by a user looking for the second-last
book in any collection of a Json document.</p>
<p>Using our structured query format, <code>Query.Levels</code>, we obtain:</p>
<pre class="fssnip highlighted"><code lang="fsharp">  [<span class="i">Any</span>,<span class="i">Property</span>(<span class="s">&quot;book&quot;</span>);<span class="i">Exact</span>,<span onmouseout="hideTip(event, 'fs36', 81)" onmouseover="showTip(event, 'fs36', 81)" class="i">Array</span>(<span class="i">Index</span><span class="o">.</span><span onmouseout="hideTip(event, 'fs37', 82)" onmouseover="showTip(event, 'fs37', 82)" class="i">Literal</span>[<span class="o">-</span><span class="n">2</span>])]
</code></pre>
<p>Now let's suppose that our datastore has a document like this:</p>
<table class="pre"><tr><td class="snippet"><pre class="fssnip"><code lang="json">{ "store":
  { "books":
    [ { "author": "Jonathan", "title": "RdKafka for F# Microservices" },
      { "author": "Jonathan", "title": "JsonPath Queries using FSharp.Data" }, 
      { "author": "Jonathan", "title": "Binary Log Search" } ]},
    "movies": [] } }
</code></pre></td></tr></table>
<p>You could imagine that it conforms to the following schema diagram.  Moreover,
the structured query format might be represented using the automaton to
its right.</p>
<img src="book-store-json.gif" class="post-slide" alt="Automaton: Second-last Book"/>
<p>In the above example, we enter the automaton at the root of the json document <code>$</code> in
the upper left.  If the root document has no <code>books</code> property, we follow the <code>..</code> epsilon
transition back to that first state - waiting for some portion of the json document that
does have a <code>books</code> property.  If some node <em>does</em> have a <code>books</code> property, we follow
it to the middle state.  If that property is an array with index <code>[-2]</code>, then we
transition to <code>Accept</code> the value at this index.</p>
<p>Consider quickly the following json document:</p>
<table class="pre"><tr><td class="snippet"><pre class="fssnip"><code lang="json">{ "books": { "books": [ 0, "success", { "books": 3 } ]} }
</code></pre></td></tr></table>
<p>From the starting state, you follow both the possibility that books is an array with
a second last element, but also, that books transitions back to the start state and
matches with some child <code>books</code> array inside that first <code>books</code> property.</p>
<h3>Transition Fun</h3>
<p>Since the current <code>State</code> of an Automaton takes arbitrary json <code>Input</code>, and
produces a new collection of <code>States</code>, this transition can be written recursively.  The
function below interprets <code>Input</code> differently depending on the <code>Query</code> path level
we're currently trying to satisfy.  This models the <em>structure</em> of the automaton for
a given <code>Query</code>.</p>
<p>The cases are as follows:</p>
<pre class="fssnip highlighted"><code lang="fsharp">        <span class="k">let</span> <span class="k">rec</span> <span onmouseout="hideTip(event, 'fs46', 83)" onmouseover="showTip(event, 'fs46', 83)" class="f">transition</span> (<span onmouseout="hideTip(event, 'fs47', 84)" onmouseover="showTip(event, 'fs47', 84)" class="i">levels</span><span class="o">:</span><span onmouseout="hideTip(event, 'fs44', 85)" onmouseover="showTip(event, 'fs44', 85)" class="t">Query</span><span class="o">.</span><span onmouseout="hideTip(event, 'fs18', 86)" onmouseover="showTip(event, 'fs18', 86)" class="t">Levels</span>) <span class="o">:</span> <span onmouseout="hideTip(event, 'fs39', 87)" onmouseover="showTip(event, 'fs39', 87)" class="t">Automaton</span> <span class="o">=</span>
            <span class="k">match</span> <span onmouseout="hideTip(event, 'fs47', 88)" onmouseover="showTip(event, 'fs47', 88)" class="i">levels</span> <span class="k">with</span>
            
            <span class="c">// 1. nothing to match matches nothing</span>
            | [] <span class="k">-&gt;</span> <span class="k">fun</span> _ <span class="k">-&gt;</span> []

            <span class="c">// 2. looking for a property of name n with scope s</span>
            | (<span onmouseout="hideTip(event, 'fs48', 89)" onmouseover="showTip(event, 'fs48', 89)" class="i">s</span>,<span onmouseout="hideTip(event, 'fs44', 90)" onmouseover="showTip(event, 'fs44', 90)" class="t">Query</span><span class="o">.</span><span onmouseout="hideTip(event, 'fs23', 91)" onmouseover="showTip(event, 'fs23', 91)" class="p">Property</span>(<span onmouseout="hideTip(event, 'fs49', 92)" onmouseover="showTip(event, 'fs49', 92)" class="i">n</span>)) <span class="o">::</span> <span onmouseout="hideTip(event, 'fs50', 93)" onmouseover="showTip(event, 'fs50', 93)" class="i">tail</span> <span class="k">-&gt;</span>
                <span class="k">function</span>
                | <span onmouseout="hideTip(event, 'fs40', 94)" onmouseover="showTip(event, 'fs40', 94)" class="t">Input</span><span class="o">.</span><span onmouseout="hideTip(event, 'fs51', 95)" onmouseover="showTip(event, 'fs51', 95)" class="p">Array</span> _ <span class="k">-&gt;</span> []
                | <span onmouseout="hideTip(event, 'fs40', 96)" onmouseover="showTip(event, 'fs40', 96)" class="t">Input</span><span class="o">.</span><span onmouseout="hideTip(event, 'fs43', 97)" onmouseover="showTip(event, 'fs43', 97)" class="p">Property</span> <span onmouseout="hideTip(event, 'fs52', 98)" onmouseover="showTip(event, 'fs52', 98)" class="i">name</span> <span class="k">-&gt;</span>
                    <span class="c">// 2a) does the input property name match?</span>
                    <span class="k">match</span> <span onmouseout="hideTip(event, 'fs52', 99)" onmouseover="showTip(event, 'fs52', 99)" class="i">name</span> <span class="k">with</span>
                    | <span onmouseout="hideTip(event, 'fs53', 100)" onmouseover="showTip(event, 'fs53', 100)" class="i">x</span> <span class="k">when</span> <span onmouseout="hideTip(event, 'fs53', 101)" onmouseover="showTip(event, 'fs53', 101)" class="i">x</span><span class="o">=</span><span onmouseout="hideTip(event, 'fs49', 102)" onmouseover="showTip(event, 'fs49', 102)" class="i">n</span> <span class="o">||</span> <span class="s">&quot;*&quot;</span><span class="o">=</span><span onmouseout="hideTip(event, 'fs49', 103)" onmouseover="showTip(event, 'fs49', 103)" class="i">n</span> <span class="k">-&gt;</span>
                        <span class="k">match</span> <span onmouseout="hideTip(event, 'fs50', 104)" onmouseover="showTip(event, 'fs50', 104)" class="i">tail</span> <span class="k">with</span>
                        <span class="c">// if nothing remains to match,</span>
                        <span class="c">// we accept this value</span>
                        | [] <span class="k">-&gt;</span> [ <span onmouseout="hideTip(event, 'fs42', 105)" onmouseover="showTip(event, 'fs42', 105)" class="p">Match</span> ]
                        <span class="c">// otherwise, we continue to take input</span>
                        <span class="c">// for the rest of our query</span>
                        | <span onmouseout="hideTip(event, 'fs54', 106)" onmouseover="showTip(event, 'fs54', 106)" class="i">xs</span> <span class="k">-&gt;</span> [ <span onmouseout="hideTip(event, 'fs39', 107)" onmouseover="showTip(event, 'fs39', 107)" class="p">Automaton</span> (<span onmouseout="hideTip(event, 'fs46', 108)" onmouseover="showTip(event, 'fs46', 108)" class="f">transition</span> <span onmouseout="hideTip(event, 'fs54', 109)" onmouseover="showTip(event, 'fs54', 109)" class="i">xs</span>) ]
                    | _ <span class="k">-&gt;</span> []
                    <span class="o">@</span>
                    <span class="c">// 2b) does the scope also include</span>
                    <span class="c">//     anything in the subtree?</span>
                    <span class="k">match</span> <span onmouseout="hideTip(event, 'fs48', 110)" onmouseover="showTip(event, 'fs48', 110)" class="i">s</span> <span class="k">with</span>
                    | <span onmouseout="hideTip(event, 'fs44', 111)" onmouseover="showTip(event, 'fs44', 111)" class="t">Query</span><span class="o">.</span><span onmouseout="hideTip(event, 'fs27', 112)" onmouseover="showTip(event, 'fs27', 112)" class="p">Any</span> <span class="k">-&gt;</span> [ <span onmouseout="hideTip(event, 'fs39', 113)" onmouseover="showTip(event, 'fs39', 113)" class="p">Automaton</span> (<span onmouseout="hideTip(event, 'fs46', 114)" onmouseover="showTip(event, 'fs46', 114)" class="f">transition</span> <span onmouseout="hideTip(event, 'fs47', 115)" onmouseover="showTip(event, 'fs47', 115)" class="i">levels</span>) ]
                    | <span onmouseout="hideTip(event, 'fs44', 116)" onmouseover="showTip(event, 'fs44', 116)" class="t">Query</span><span class="o">.</span><span onmouseout="hideTip(event, 'fs28', 117)" onmouseover="showTip(event, 'fs28', 117)" class="p">Exact</span> <span class="k">-&gt;</span> []
                
            <span class="c">// 3. looking for an array with a matching index</span>
            | (<span onmouseout="hideTip(event, 'fs48', 118)" onmouseover="showTip(event, 'fs48', 118)" class="i">s</span>,<span onmouseout="hideTip(event, 'fs44', 119)" onmouseover="showTip(event, 'fs44', 119)" class="t">Query</span><span class="o">.</span><span onmouseout="hideTip(event, 'fs55', 120)" onmouseover="showTip(event, 'fs55', 120)" class="p">Array</span>(<span onmouseout="hideTip(event, 'fs56', 121)" onmouseover="showTip(event, 'fs56', 121)" class="i">i</span>)) <span class="o">::</span> <span onmouseout="hideTip(event, 'fs50', 122)" onmouseover="showTip(event, 'fs50', 122)" class="i">tail</span> <span class="k">-&gt;</span>
                <span class="k">function</span>
                | <span onmouseout="hideTip(event, 'fs40', 123)" onmouseover="showTip(event, 'fs40', 123)" class="t">Input</span><span class="o">.</span><span onmouseout="hideTip(event, 'fs43', 124)" onmouseover="showTip(event, 'fs43', 124)" class="p">Property</span> _ <span class="k">-&gt;</span> []
                | <span onmouseout="hideTip(event, 'fs40', 125)" onmouseover="showTip(event, 'fs40', 125)" class="t">Input</span><span class="o">.</span><span onmouseout="hideTip(event, 'fs51', 126)" onmouseover="showTip(event, 'fs51', 126)" class="p">Array</span> (<span onmouseout="hideTip(event, 'fs57', 127)" onmouseover="showTip(event, 'fs57', 127)" class="i">index</span>,<span onmouseout="hideTip(event, 'fs58', 128)" onmouseover="showTip(event, 'fs58', 128)" class="i">length</span>) <span class="k">-&gt;</span>
                    <span class="k">match</span> <span onmouseout="hideTip(event, 'fs56', 129)" onmouseover="showTip(event, 'fs56', 129)" class="i">i</span> <span class="k">with</span>

                    <span class="c">// 3a) querying for all indices?</span>
                    | <span onmouseout="hideTip(event, 'fs44', 130)" onmouseover="showTip(event, 'fs44', 130)" class="t">Query</span><span class="o">.</span><span onmouseout="hideTip(event, 'fs26', 131)" onmouseover="showTip(event, 'fs26', 131)" class="t">Index</span><span class="o">.</span><span onmouseout="hideTip(event, 'fs30', 132)" onmouseover="showTip(event, 'fs30', 132)" class="p">Wildcard</span> <span class="k">-&gt;</span>
                        <span class="k">match</span> <span onmouseout="hideTip(event, 'fs50', 133)" onmouseover="showTip(event, 'fs50', 133)" class="i">tail</span> <span class="k">with</span>
                        <span class="c">// if nothing remains in the query,</span>
                        <span class="c">// we accept this value</span>
                        | [] <span class="k">-&gt;</span> [ <span onmouseout="hideTip(event, 'fs42', 134)" onmouseover="showTip(event, 'fs42', 134)" class="p">Match</span> ]
                        <span class="c">// otherwise, we continue to take input</span>
                        <span class="c">// for the rest of our query</span>
                        | <span onmouseout="hideTip(event, 'fs54', 135)" onmouseover="showTip(event, 'fs54', 135)" class="i">xs</span> <span class="k">-&gt;</span> [ <span onmouseout="hideTip(event, 'fs39', 136)" onmouseover="showTip(event, 'fs39', 136)" class="p">Automaton</span> (<span onmouseout="hideTip(event, 'fs46', 137)" onmouseover="showTip(event, 'fs46', 137)" class="f">transition</span> <span onmouseout="hideTip(event, 'fs54', 138)" onmouseover="showTip(event, 'fs54', 138)" class="i">xs</span>) ]

                    <span class="c">// 3b) querying for specific indices?</span>
                    | <span onmouseout="hideTip(event, 'fs44', 139)" onmouseover="showTip(event, 'fs44', 139)" class="t">Query</span><span class="o">.</span><span onmouseout="hideTip(event, 'fs26', 140)" onmouseover="showTip(event, 'fs26', 140)" class="t">Index</span><span class="o">.</span><span onmouseout="hideTip(event, 'fs59', 141)" onmouseover="showTip(event, 'fs59', 141)" class="p">Literal</span> <span onmouseout="hideTip(event, 'fs60', 142)" onmouseover="showTip(event, 'fs60', 142)" class="i">xs</span> <span class="k">when</span>
                        (<span onmouseout="hideTip(event, 'fs60', 143)" onmouseover="showTip(event, 'fs60', 143)" class="i">xs</span> <span class="c">// also handle valid negative index literals:</span>
                         <span class="o">|&gt;</span> <span onmouseout="hideTip(event, 'fs61', 144)" onmouseover="showTip(event, 'fs61', 144)" class="t">List</span><span class="o">.</span><span onmouseout="hideTip(event, 'fs62', 145)" onmouseover="showTip(event, 'fs62', 145)" class="f">map</span> (<span class="k">function</span> <span onmouseout="hideTip(event, 'fs14', 146)" onmouseover="showTip(event, 'fs14', 146)" class="i">x</span> <span class="k">when</span> <span onmouseout="hideTip(event, 'fs14', 147)" onmouseover="showTip(event, 'fs14', 147)" class="i">x</span> <span class="o">&lt;</span> <span class="n">0</span> <span class="k">-&gt;</span> <span onmouseout="hideTip(event, 'fs58', 148)" onmouseover="showTip(event, 'fs58', 148)" class="i">length</span><span class="o">+</span><span onmouseout="hideTip(event, 'fs14', 149)" onmouseover="showTip(event, 'fs14', 149)" class="i">x</span> | <span onmouseout="hideTip(event, 'fs14', 150)" onmouseover="showTip(event, 'fs14', 150)" class="i">x</span> <span class="k">-&gt;</span> <span onmouseout="hideTip(event, 'fs14', 151)" onmouseover="showTip(event, 'fs14', 151)" class="i">x</span>)
                         <span class="o">|&gt;</span> <span onmouseout="hideTip(event, 'fs61', 152)" onmouseover="showTip(event, 'fs61', 152)" class="t">List</span><span class="o">.</span><span onmouseout="hideTip(event, 'fs63', 153)" onmouseover="showTip(event, 'fs63', 153)" class="f">exists</span> ((<span class="o">=</span>) <span onmouseout="hideTip(event, 'fs57', 154)" onmouseover="showTip(event, 'fs57', 154)" class="i">index</span>)) <span class="k">-&gt;</span>
                        <span class="k">match</span> <span onmouseout="hideTip(event, 'fs50', 155)" onmouseover="showTip(event, 'fs50', 155)" class="i">tail</span> <span class="k">with</span>
                        <span class="c">// if nothing remains in the query,</span>
                        <span class="c">// we accept this value</span>
                        | [] <span class="k">-&gt;</span> [ <span onmouseout="hideTip(event, 'fs42', 156)" onmouseover="showTip(event, 'fs42', 156)" class="p">Match</span> ]
                        <span class="c">// otherwise, we continue to take input</span>
                        | <span onmouseout="hideTip(event, 'fs54', 157)" onmouseover="showTip(event, 'fs54', 157)" class="i">xs</span> <span class="k">-&gt;</span> [ <span onmouseout="hideTip(event, 'fs39', 158)" onmouseover="showTip(event, 'fs39', 158)" class="p">Automaton</span> (<span onmouseout="hideTip(event, 'fs46', 159)" onmouseover="showTip(event, 'fs46', 159)" class="f">transition</span> <span onmouseout="hideTip(event, 'fs54', 160)" onmouseover="showTip(event, 'fs54', 160)" class="i">xs</span>) ]
                        
                    <span class="c">// 3c) querying for an index range (with step)?</span>
                    <span class="c">//     handle negative indices as well</span>
                    | <span onmouseout="hideTip(event, 'fs44', 161)" onmouseover="showTip(event, 'fs44', 161)" class="t">Query</span><span class="o">.</span><span onmouseout="hideTip(event, 'fs26', 162)" onmouseover="showTip(event, 'fs26', 162)" class="t">Index</span><span class="o">.</span><span onmouseout="hideTip(event, 'fs31', 163)" onmouseover="showTip(event, 'fs31', 163)" class="p">Slice</span>(<span onmouseout="hideTip(event, 'fs64', 164)" onmouseover="showTip(event, 'fs64', 164)" class="i">start</span>,<span onmouseout="hideTip(event, 'fs65', 165)" onmouseover="showTip(event, 'fs65', 165)" class="i">finish</span>,<span onmouseout="hideTip(event, 'fs66', 166)" onmouseover="showTip(event, 'fs66', 166)" class="i">step</span>) <span class="k">when</span> (<span onmouseout="hideTip(event, 'fs66', 167)" onmouseover="showTip(event, 'fs66', 167)" class="i">step</span> <span class="o">&gt;</span> <span class="n">0</span>) <span class="k">-&gt;</span>
                        <span class="k">let</span> <span onmouseout="hideTip(event, 'fs67', 168)" onmouseover="showTip(event, 'fs67', 168)" class="i">start</span> <span class="o">=</span>
                            <span class="k">match</span> <span onmouseout="hideTip(event, 'fs67', 169)" onmouseover="showTip(event, 'fs67', 169)" class="i">start</span> <span class="o">|&gt;</span> <span onmouseout="hideTip(event, 'fs10', 170)" onmouseover="showTip(event, 'fs10', 170)" class="f">valueOr</span> <span class="n">0</span> <span class="k">with</span>
                            | <span onmouseout="hideTip(event, 'fs14', 171)" onmouseover="showTip(event, 'fs14', 171)" class="i">x</span> <span class="k">when</span> <span onmouseout="hideTip(event, 'fs14', 172)" onmouseover="showTip(event, 'fs14', 172)" class="i">x</span> <span class="o">&lt;</span> <span class="n">0</span> <span class="k">-&gt;</span> <span onmouseout="hideTip(event, 'fs58', 173)" onmouseover="showTip(event, 'fs58', 173)" class="i">length</span><span class="o">+</span><span onmouseout="hideTip(event, 'fs14', 174)" onmouseover="showTip(event, 'fs14', 174)" class="i">x</span>
                            | <span onmouseout="hideTip(event, 'fs14', 175)" onmouseover="showTip(event, 'fs14', 175)" class="i">x</span> <span class="k">-&gt;</span> <span onmouseout="hideTip(event, 'fs14', 176)" onmouseover="showTip(event, 'fs14', 176)" class="i">x</span>
                        <span class="k">let</span> <span onmouseout="hideTip(event, 'fs68', 177)" onmouseover="showTip(event, 'fs68', 177)" class="i">finish</span> <span class="o">=</span>
                            <span class="k">match</span> <span onmouseout="hideTip(event, 'fs68', 178)" onmouseover="showTip(event, 'fs68', 178)" class="i">finish</span> <span class="o">|&gt;</span> <span onmouseout="hideTip(event, 'fs10', 179)" onmouseover="showTip(event, 'fs10', 179)" class="f">valueOr</span> <span onmouseout="hideTip(event, 'fs58', 180)" onmouseover="showTip(event, 'fs58', 180)" class="i">length</span> <span class="k">with</span>
                            | <span onmouseout="hideTip(event, 'fs14', 181)" onmouseover="showTip(event, 'fs14', 181)" class="i">x</span> <span class="k">when</span> <span onmouseout="hideTip(event, 'fs14', 182)" onmouseover="showTip(event, 'fs14', 182)" class="i">x</span> <span class="o">&lt;=</span> <span class="n">0</span> <span class="k">-&gt;</span> <span onmouseout="hideTip(event, 'fs58', 183)" onmouseover="showTip(event, 'fs58', 183)" class="i">length</span><span class="o">+</span><span onmouseout="hideTip(event, 'fs14', 184)" onmouseover="showTip(event, 'fs14', 184)" class="i">x</span>
                            | <span onmouseout="hideTip(event, 'fs14', 185)" onmouseover="showTip(event, 'fs14', 185)" class="i">x</span> <span class="k">-&gt;</span> <span onmouseout="hideTip(event, 'fs14', 186)" onmouseover="showTip(event, 'fs14', 186)" class="i">x</span>
                        <span class="k">if</span> (<span onmouseout="hideTip(event, 'fs68', 187)" onmouseover="showTip(event, 'fs68', 187)" class="i">finish</span> <span class="o">&gt;</span> <span onmouseout="hideTip(event, 'fs57', 188)" onmouseover="showTip(event, 'fs57', 188)" class="i">index</span> <span class="o">&amp;&amp;</span> <span onmouseout="hideTip(event, 'fs57', 189)" onmouseover="showTip(event, 'fs57', 189)" class="i">index</span> <span class="o">&gt;</span><span class="o">=</span> <span onmouseout="hideTip(event, 'fs67', 190)" onmouseover="showTip(event, 'fs67', 190)" class="i">start</span>) <span class="o">&amp;&amp;</span>
                           (<span class="n">0</span> <span class="o">=</span> (<span onmouseout="hideTip(event, 'fs57', 191)" onmouseover="showTip(event, 'fs57', 191)" class="i">index</span><span class="o">-</span><span onmouseout="hideTip(event, 'fs67', 192)" onmouseover="showTip(event, 'fs67', 192)" class="i">start</span>) <span class="o">%</span> <span onmouseout="hideTip(event, 'fs66', 193)" onmouseover="showTip(event, 'fs66', 193)" class="i">step</span>) <span class="k">then</span>
                            <span class="k">match</span> <span onmouseout="hideTip(event, 'fs50', 194)" onmouseover="showTip(event, 'fs50', 194)" class="i">tail</span> <span class="k">with</span>
                            | [] <span class="k">-&gt;</span> [ <span onmouseout="hideTip(event, 'fs42', 195)" onmouseover="showTip(event, 'fs42', 195)" class="p">Match</span> ]
                            | <span onmouseout="hideTip(event, 'fs54', 196)" onmouseover="showTip(event, 'fs54', 196)" class="i">xs</span> <span class="k">-&gt;</span> [ <span onmouseout="hideTip(event, 'fs39', 197)" onmouseover="showTip(event, 'fs39', 197)" class="p">Automaton</span> (<span onmouseout="hideTip(event, 'fs46', 198)" onmouseover="showTip(event, 'fs46', 198)" class="f">transition</span> <span onmouseout="hideTip(event, 'fs54', 199)" onmouseover="showTip(event, 'fs54', 199)" class="i">xs</span>) ]
                        <span class="k">else</span> []
                    | _ <span class="k">-&gt;</span> []
                    <span class="o">@</span>
                    <span class="k">match</span> <span onmouseout="hideTip(event, 'fs48', 200)" onmouseover="showTip(event, 'fs48', 200)" class="i">s</span> <span class="k">with</span>
                    <span class="c">// does the scope also include</span>
                    <span class="c">// anything in the subtree?</span>
                    | <span onmouseout="hideTip(event, 'fs44', 201)" onmouseover="showTip(event, 'fs44', 201)" class="t">Query</span><span class="o">.</span><span onmouseout="hideTip(event, 'fs27', 202)" onmouseover="showTip(event, 'fs27', 202)" class="p">Any</span> <span class="k">-&gt;</span> [ <span onmouseout="hideTip(event, 'fs39', 203)" onmouseover="showTip(event, 'fs39', 203)" class="p">Automaton</span> (<span onmouseout="hideTip(event, 'fs46', 204)" onmouseover="showTip(event, 'fs46', 204)" class="f">transition</span> <span onmouseout="hideTip(event, 'fs47', 205)" onmouseover="showTip(event, 'fs47', 205)" class="i">levels</span>) ]
                    | <span onmouseout="hideTip(event, 'fs44', 206)" onmouseover="showTip(event, 'fs44', 206)" class="t">Query</span><span class="o">.</span><span onmouseout="hideTip(event, 'fs28', 207)" onmouseover="showTip(event, 'fs28', 207)" class="p">Exact</span> <span class="k">-&gt;</span> []
</code></pre>
<p>The starting state for the automaton is a function accepting input
matching the current query:</p>
<pre class="fssnip highlighted"><code lang="fsharp">        <span class="k">let</span> <span onmouseout="hideTip(event, 'fs69', 208)" onmouseover="showTip(event, 'fs69', 208)" class="f">create</span> (<span onmouseout="hideTip(event, 'fs47', 209)" onmouseover="showTip(event, 'fs47', 209)" class="i">levels</span><span class="o">:</span><span onmouseout="hideTip(event, 'fs44', 210)" onmouseover="showTip(event, 'fs44', 210)" class="t">Query</span><span class="o">.</span><span onmouseout="hideTip(event, 'fs18', 211)" onmouseover="showTip(event, 'fs18', 211)" class="t">Levels</span>) <span class="o">:</span> <span onmouseout="hideTip(event, 'fs41', 212)" onmouseover="showTip(event, 'fs41', 212)" class="t">State</span> <span class="o">=</span>
            <span onmouseout="hideTip(event, 'fs39', 213)" onmouseover="showTip(event, 'fs39', 213)" class="p">Automaton</span> (<span onmouseout="hideTip(event, 'fs46', 214)" onmouseover="showTip(event, 'fs46', 214)" class="f">transition</span> <span onmouseout="hideTip(event, 'fs47', 215)" onmouseover="showTip(event, 'fs47', 215)" class="i">levels</span>)
</code></pre>
<p>So far, we've created a structured representation of an arbitrary JsonPath query.  We've also
defined state transitions based on that representation.  These give us automata capable
of matching any user-defined query.</p>
<h3>Search</h3>
<p>Next, we'll look at actually running the search sequence for a given automaton and json document.</p>
<p>Finding a sequence of matching json values can also be defined recursively.  Here, <code>findSeq</code> is
a function accepting a list of current states and some json value (effectively, our <em>positions</em> in
the state machine and document).</p>
<pre class="fssnip highlighted"><code lang="fsharp">    <span class="k">let</span> <span onmouseout="hideTip(event, 'fs70', 216)" onmouseover="showTip(event, 'fs70', 216)" class="f">findSeq</span> <span class="o">=</span> 

        <span class="k">let</span> <span onmouseout="hideTip(event, 'fs71', 217)" onmouseover="showTip(event, 'fs71', 217)" class="f">partition</span> <span class="o">=</span>
            <span onmouseout="hideTip(event, 'fs61', 218)" onmouseover="showTip(event, 'fs61', 218)" class="t">List</span><span class="o">.</span><span onmouseout="hideTip(event, 'fs72', 219)" onmouseover="showTip(event, 'fs72', 219)" class="f">fold</span> (<span class="k">fun</span> (<span onmouseout="hideTip(event, 'fs73', 220)" onmouseover="showTip(event, 'fs73', 220)" class="i">matches</span>, <span onmouseout="hideTip(event, 'fs74', 221)" onmouseover="showTip(event, 'fs74', 221)" class="i">automata</span>) <span class="k">-&gt;</span> <span class="k">function</span>
                | <span onmouseout="hideTip(event, 'fs75', 222)" onmouseover="showTip(event, 'fs75', 222)" class="t">Pattern</span><span class="o">.</span><span onmouseout="hideTip(event, 'fs41', 223)" onmouseover="showTip(event, 'fs41', 223)" class="t">State</span><span class="o">.</span><span onmouseout="hideTip(event, 'fs76', 224)" onmouseover="showTip(event, 'fs76', 224)" class="p">Match</span> <span class="k">-&gt;</span> <span class="k">true</span>, <span onmouseout="hideTip(event, 'fs74', 225)" onmouseover="showTip(event, 'fs74', 225)" class="i">automata</span>
                | <span onmouseout="hideTip(event, 'fs75', 226)" onmouseover="showTip(event, 'fs75', 226)" class="t">Pattern</span><span class="o">.</span><span onmouseout="hideTip(event, 'fs41', 227)" onmouseover="showTip(event, 'fs41', 227)" class="t">State</span><span class="o">.</span><span onmouseout="hideTip(event, 'fs77', 228)" onmouseover="showTip(event, 'fs77', 228)" class="p">Automaton</span> <span onmouseout="hideTip(event, 'fs78', 229)" onmouseover="showTip(event, 'fs78', 229)" class="f">x</span> <span class="k">-&gt;</span> <span onmouseout="hideTip(event, 'fs73', 230)" onmouseover="showTip(event, 'fs73', 230)" class="i">matches</span>, <span onmouseout="hideTip(event, 'fs78', 231)" onmouseover="showTip(event, 'fs78', 231)" class="f">x</span> <span class="o">::</span> <span onmouseout="hideTip(event, 'fs74', 232)" onmouseover="showTip(event, 'fs74', 232)" class="i">automata</span>) (<span class="k">false</span>, [])

        <span class="k">let</span> <span class="k">rec</span> <span onmouseout="hideTip(event, 'fs79', 233)" onmouseover="showTip(event, 'fs79', 233)" class="f">recurse</span> <span class="o">=</span> <span class="k">function</span>
            | [] <span class="k">-&gt;</span> <span onmouseout="hideTip(event, 'fs80', 234)" onmouseover="showTip(event, 'fs80', 234)" class="t">Seq</span><span class="o">.</span><span onmouseout="hideTip(event, 'fs81', 235)" onmouseover="showTip(event, 'fs81', 235)" class="i">empty</span>
            | (<span onmouseout="hideTip(event, 'fs82', 236)" onmouseover="showTip(event, 'fs82', 236)" class="i">states</span><span class="o">:</span><span onmouseout="hideTip(event, 'fs75', 237)" onmouseover="showTip(event, 'fs75', 237)" class="t">Pattern</span><span class="o">.</span><span onmouseout="hideTip(event, 'fs41', 238)" onmouseover="showTip(event, 'fs41', 238)" class="t">State</span> <span onmouseout="hideTip(event, 'fs20', 239)" onmouseover="showTip(event, 'fs20', 239)" class="t">list</span>, <span onmouseout="hideTip(event, 'fs83', 240)" onmouseover="showTip(event, 'fs83', 240)" class="i">value</span><span class="o">:</span><span onmouseout="hideTip(event, 'fs9', 241)" onmouseover="showTip(event, 'fs9', 241)" class="t">JsonValue</span>) <span class="o">::</span> <span onmouseout="hideTip(event, 'fs84', 242)" onmouseover="showTip(event, 'fs84', 242)" class="i">positions</span> <span class="k">-&gt;</span>
</code></pre>
<p>This representation works especially well with long linear datastructures that might otherwise
cause a <code>StackOverflowException</code>. For example:</p>
<table class="pre"><tr><td class="snippet"><pre class="fssnip"><code lang="json"> { "100000":
   { "99999":
     { "99998":
       { "99997": 
         // ...
           { "2":
             { "1":
               { "0": null } } }
         // ...
       } } } }
</code></pre></td></tr></table>
<p>If any of the states is a <code>Match</code> state, we yield the current <code>JsonValue</code>.  But also, we can
continue to check the remaining automata for matches:</p>
<pre class="fssnip highlighted"><code lang="fsharp">                <span onmouseout="hideTip(event, 'fs85', 243)" onmouseover="showTip(event, 'fs85', 243)" class="i">seq</span> {
                    <span class="k">let</span> <span onmouseout="hideTip(event, 'fs86', 244)" onmouseover="showTip(event, 'fs86', 244)" class="i">hasMatch</span>, <span onmouseout="hideTip(event, 'fs74', 245)" onmouseover="showTip(event, 'fs74', 245)" class="i">automata</span> <span class="o">=</span> <span onmouseout="hideTip(event, 'fs71', 246)" onmouseover="showTip(event, 'fs71', 246)" class="f">partition</span> <span onmouseout="hideTip(event, 'fs82', 247)" onmouseover="showTip(event, 'fs82', 247)" class="i">states</span>
                    <span class="k">if</span> <span onmouseout="hideTip(event, 'fs86', 248)" onmouseover="showTip(event, 'fs86', 248)" class="i">hasMatch</span> <span class="k">then</span>
                        <span class="k">yield</span> <span onmouseout="hideTip(event, 'fs83', 249)" onmouseover="showTip(event, 'fs83', 249)" class="i">value</span>

                    <span class="k">yield!</span>
                        <span class="k">match</span> <span onmouseout="hideTip(event, 'fs83', 250)" onmouseover="showTip(event, 'fs83', 250)" class="i">value</span> <span class="k">with</span>
                        <span class="c">// (1) for a record, we apply the property name to the</span>
                        <span class="c">//     automata to obtain new states, and recurse:</span>
                        | <span onmouseout="hideTip(event, 'fs9', 251)" onmouseover="showTip(event, 'fs9', 251)" class="t">JsonValue</span><span class="o">.</span><span onmouseout="hideTip(event, 'fs87', 252)" onmouseover="showTip(event, 'fs87', 252)" class="p">Record</span> <span onmouseout="hideTip(event, 'fs88', 253)" onmouseover="showTip(event, 'fs88', 253)" class="i">xs</span> <span class="k">-&gt;</span>
                            <span onmouseout="hideTip(event, 'fs88', 254)" onmouseover="showTip(event, 'fs88', 254)" class="i">xs</span>
                            <span class="o">|&gt;</span> <span onmouseout="hideTip(event, 'fs89', 255)" onmouseover="showTip(event, 'fs89', 255)" class="t">Array</span><span class="o">.</span><span onmouseout="hideTip(event, 'fs90', 256)" onmouseover="showTip(event, 'fs90', 256)" class="f">map</span>(<span class="k">fun</span> (<span onmouseout="hideTip(event, 'fs91', 257)" onmouseover="showTip(event, 'fs91', 257)" class="i">name</span>,<span onmouseout="hideTip(event, 'fs92', 258)" onmouseover="showTip(event, 'fs92', 258)" class="i">json</span>) <span class="k">-&gt;</span>
                                <span onmouseout="hideTip(event, 'fs74', 259)" onmouseover="showTip(event, 'fs74', 259)" class="i">automata</span>
                                <span class="o">|&gt;</span> <span onmouseout="hideTip(event, 'fs61', 260)" onmouseover="showTip(event, 'fs61', 260)" class="t">List</span><span class="o">.</span><span onmouseout="hideTip(event, 'fs93', 261)" onmouseover="showTip(event, 'fs93', 261)" class="f">collect</span>(<span class="k">fun</span> <span onmouseout="hideTip(event, 'fs94', 262)" onmouseover="showTip(event, 'fs94', 262)" class="f">a</span> <span class="k">-&gt;</span> 
                                    <span onmouseout="hideTip(event, 'fs94', 263)" onmouseover="showTip(event, 'fs94', 263)" class="f">a</span> (<span onmouseout="hideTip(event, 'fs75', 264)" onmouseover="showTip(event, 'fs75', 264)" class="t">Pattern</span><span class="o">.</span><span onmouseout="hideTip(event, 'fs40', 265)" onmouseover="showTip(event, 'fs40', 265)" class="t">Input</span><span class="o">.</span><span onmouseout="hideTip(event, 'fs43', 266)" onmouseover="showTip(event, 'fs43', 266)" class="p">Property</span> <span onmouseout="hideTip(event, 'fs91', 267)" onmouseover="showTip(event, 'fs91', 267)" class="i">name</span>)),
                                <span onmouseout="hideTip(event, 'fs92', 268)" onmouseover="showTip(event, 'fs92', 268)" class="i">json</span>)
                        <span class="c">// (2) for an array, we apply the index values to the</span>
                        <span class="c">//     automata to obtain new states, and recurse:</span>
                        | <span onmouseout="hideTip(event, 'fs9', 269)" onmouseover="showTip(event, 'fs9', 269)" class="t">JsonValue</span><span class="o">.</span><span onmouseout="hideTip(event, 'fs95', 270)" onmouseover="showTip(event, 'fs95', 270)" class="p">Array</span> <span onmouseout="hideTip(event, 'fs96', 271)" onmouseover="showTip(event, 'fs96', 271)" class="i">xs</span> <span class="k">-&gt;</span>
                            <span onmouseout="hideTip(event, 'fs96', 272)" onmouseover="showTip(event, 'fs96', 272)" class="i">xs</span>
                            <span class="o">|&gt;</span> <span onmouseout="hideTip(event, 'fs89', 273)" onmouseover="showTip(event, 'fs89', 273)" class="t">Array</span><span class="o">.</span><span onmouseout="hideTip(event, 'fs97', 274)" onmouseover="showTip(event, 'fs97', 274)" class="f">mapi</span>(<span class="k">fun</span> <span onmouseout="hideTip(event, 'fs98', 275)" onmouseover="showTip(event, 'fs98', 275)" class="i">i</span> <span onmouseout="hideTip(event, 'fs92', 276)" onmouseover="showTip(event, 'fs92', 276)" class="i">json</span> <span class="k">-&gt;</span>
                                <span onmouseout="hideTip(event, 'fs74', 277)" onmouseover="showTip(event, 'fs74', 277)" class="i">automata</span>
                                <span class="o">|&gt;</span> <span onmouseout="hideTip(event, 'fs61', 278)" onmouseover="showTip(event, 'fs61', 278)" class="t">List</span><span class="o">.</span><span onmouseout="hideTip(event, 'fs93', 279)" onmouseover="showTip(event, 'fs93', 279)" class="f">collect</span>(<span class="k">fun</span> <span onmouseout="hideTip(event, 'fs94', 280)" onmouseover="showTip(event, 'fs94', 280)" class="f">a</span> <span class="k">-&gt;</span>
                                    <span onmouseout="hideTip(event, 'fs94', 281)" onmouseover="showTip(event, 'fs94', 281)" class="f">a</span> (<span onmouseout="hideTip(event, 'fs75', 282)" onmouseover="showTip(event, 'fs75', 282)" class="t">Pattern</span><span class="o">.</span><span onmouseout="hideTip(event, 'fs40', 283)" onmouseover="showTip(event, 'fs40', 283)" class="t">Input</span><span class="o">.</span><span onmouseout="hideTip(event, 'fs51', 284)" onmouseover="showTip(event, 'fs51', 284)" class="p">Array</span>(<span onmouseout="hideTip(event, 'fs98', 285)" onmouseover="showTip(event, 'fs98', 285)" class="i">i</span>,<span onmouseout="hideTip(event, 'fs96', 286)" onmouseover="showTip(event, 'fs96', 286)" class="i">xs</span><span class="o">.</span><span onmouseout="hideTip(event, 'fs99', 287)" onmouseover="showTip(event, 'fs99', 287)" class="i">Length</span>))),
                                <span onmouseout="hideTip(event, 'fs92', 288)" onmouseover="showTip(event, 'fs92', 288)" class="i">json</span>)
                        | _ <span class="k">-&gt;</span> <span onmouseout="hideTip(event, 'fs89', 289)" onmouseover="showTip(event, 'fs89', 289)" class="t">Array</span><span class="o">.</span><span onmouseout="hideTip(event, 'fs100', 290)" onmouseover="showTip(event, 'fs100', 290)" class="i">empty</span>
                        <span class="o">|&gt;</span> <span onmouseout="hideTip(event, 'fs89', 291)" onmouseover="showTip(event, 'fs89', 291)" class="t">Array</span><span class="o">.</span><span onmouseout="hideTip(event, 'fs101', 292)" onmouseover="showTip(event, 'fs101', 292)" class="f">foldBack</span> (<span class="k">fun</span> <span onmouseout="hideTip(event, 'fs102', 293)" onmouseover="showTip(event, 'fs102', 293)" class="i">x</span> <span onmouseout="hideTip(event, 'fs103', 294)" onmouseover="showTip(event, 'fs103', 294)" class="i">xs</span> <span class="k">-&gt;</span> <span onmouseout="hideTip(event, 'fs102', 295)" onmouseover="showTip(event, 'fs102', 295)" class="i">x</span> <span class="o">::</span> <span onmouseout="hideTip(event, 'fs103', 296)" onmouseover="showTip(event, 'fs103', 296)" class="i">xs</span>) <span class="o">&lt;|</span> <span onmouseout="hideTip(event, 'fs84', 297)" onmouseover="showTip(event, 'fs84', 297)" class="i">positions</span>
                        <span class="o">|&gt;</span> <span onmouseout="hideTip(event, 'fs79', 298)" onmouseover="showTip(event, 'fs79', 298)" class="f">recurse</span>
                }  
</code></pre>
<p>We also handle <code>$.</code> as a unique case for matching the document itself:</p>
<pre class="fssnip highlighted"><code lang="fsharp">        <span onmouseout="hideTip(event, 'fs44', 299)" onmouseover="showTip(event, 'fs44', 299)" class="t">Query</span><span class="o">.</span><span onmouseout="hideTip(event, 'fs34', 300)" onmouseover="showTip(event, 'fs34', 300)" class="f">levelsFor</span> <span class="o">&gt;</span><span class="o">&gt;</span> <span class="k">function</span>
        | [<span onmouseout="hideTip(event, 'fs44', 301)" onmouseover="showTip(event, 'fs44', 301)" class="t">Query</span><span class="o">.</span><span onmouseout="hideTip(event, 'fs28', 302)" onmouseover="showTip(event, 'fs28', 302)" class="p">Exact</span>,<span onmouseout="hideTip(event, 'fs44', 303)" onmouseover="showTip(event, 'fs44', 303)" class="t">Query</span><span class="o">.</span><span onmouseout="hideTip(event, 'fs23', 304)" onmouseover="showTip(event, 'fs23', 304)" class="p">Property</span> <span class="s">&quot;&quot;</span>] <span class="k">-&gt;</span> <span onmouseout="hideTip(event, 'fs80', 305)" onmouseover="showTip(event, 'fs80', 305)" class="t">Seq</span><span class="o">.</span><span onmouseout="hideTip(event, 'fs104', 306)" onmouseover="showTip(event, 'fs104', 306)" class="f">singleton</span>
        | (<span onmouseout="hideTip(event, 'fs44', 307)" onmouseover="showTip(event, 'fs44', 307)" class="t">Query</span><span class="o">.</span><span onmouseout="hideTip(event, 'fs28', 308)" onmouseover="showTip(event, 'fs28', 308)" class="p">Exact</span>,<span onmouseout="hideTip(event, 'fs44', 309)" onmouseover="showTip(event, 'fs44', 309)" class="t">Query</span><span class="o">.</span><span onmouseout="hideTip(event, 'fs23', 310)" onmouseover="showTip(event, 'fs23', 310)" class="p">Property</span> <span class="s">&quot;&quot;</span>)<span class="o">::</span><span onmouseout="hideTip(event, 'fs105', 311)" onmouseover="showTip(event, 'fs105', 311)" class="i">levels</span>
        | <span onmouseout="hideTip(event, 'fs105', 312)" onmouseover="showTip(event, 'fs105', 312)" class="i">levels</span> <span class="k">-&gt;</span>
            <span class="k">let</span> <span onmouseout="hideTip(event, 'fs106', 313)" onmouseover="showTip(event, 'fs106', 313)" class="i">start</span> <span class="o">=</span> <span onmouseout="hideTip(event, 'fs75', 314)" onmouseover="showTip(event, 'fs75', 314)" class="t">Pattern</span><span class="o">.</span><span onmouseout="hideTip(event, 'fs69', 315)" onmouseover="showTip(event, 'fs69', 315)" class="f">create</span> <span onmouseout="hideTip(event, 'fs105', 316)" onmouseover="showTip(event, 'fs105', 316)" class="i">levels</span>
            <span class="k">fun</span> <span onmouseout="hideTip(event, 'fs92', 317)" onmouseover="showTip(event, 'fs92', 317)" class="i">json</span> <span class="k">-&gt;</span> <span onmouseout="hideTip(event, 'fs79', 318)" onmouseover="showTip(event, 'fs79', 318)" class="f">recurse</span>[[<span onmouseout="hideTip(event, 'fs106', 319)" onmouseover="showTip(event, 'fs106', 319)" class="i">start</span>],<span onmouseout="hideTip(event, 'fs92', 320)" onmouseover="showTip(event, 'fs92', 320)" class="i">json</span>]
</code></pre>
<p>And for convenience, we add a few different mechanisms to eagerly evaluate the
search, or optionally obtain the first match case:</p>
<pre class="fssnip highlighted"><code lang="fsharp">    <span class="k">let</span> <span onmouseout="hideTip(event, 'fs107', 321)" onmouseover="showTip(event, 'fs107', 321)" class="f">findList</span> <span onmouseout="hideTip(event, 'fs108', 322)" onmouseover="showTip(event, 'fs108', 322)" class="i">query</span> <span class="o">=</span>
        <span onmouseout="hideTip(event, 'fs70', 323)" onmouseover="showTip(event, 'fs70', 323)" class="f">findSeq</span> <span onmouseout="hideTip(event, 'fs108', 324)" onmouseover="showTip(event, 'fs108', 324)" class="i">query</span> <span class="o">&gt;</span><span class="o">&gt;</span> <span onmouseout="hideTip(event, 'fs80', 325)" onmouseover="showTip(event, 'fs80', 325)" class="t">Seq</span><span class="o">.</span><span onmouseout="hideTip(event, 'fs109', 326)" onmouseover="showTip(event, 'fs109', 326)" class="f">toList</span>

    <span class="k">let</span> <span onmouseout="hideTip(event, 'fs110', 327)" onmouseover="showTip(event, 'fs110', 327)" class="f">find</span> <span onmouseout="hideTip(event, 'fs108', 328)" onmouseover="showTip(event, 'fs108', 328)" class="i">query</span> <span class="o">=</span>
        <span onmouseout="hideTip(event, 'fs70', 329)" onmouseover="showTip(event, 'fs70', 329)" class="f">findSeq</span> <span onmouseout="hideTip(event, 'fs108', 330)" onmouseover="showTip(event, 'fs108', 330)" class="i">query</span> <span class="o">&gt;</span><span class="o">&gt;</span> <span onmouseout="hideTip(event, 'fs80', 331)" onmouseover="showTip(event, 'fs80', 331)" class="t">Seq</span><span class="o">.</span><span onmouseout="hideTip(event, 'fs111', 332)" onmouseover="showTip(event, 'fs111', 332)" class="f">head</span>

    <span class="k">let</span> <span onmouseout="hideTip(event, 'fs112', 333)" onmouseover="showTip(event, 'fs112', 333)" class="f">tryFind</span> <span onmouseout="hideTip(event, 'fs108', 334)" onmouseover="showTip(event, 'fs108', 334)" class="i">query</span> <span class="o">=</span>
        <span onmouseout="hideTip(event, 'fs70', 335)" onmouseover="showTip(event, 'fs70', 335)" class="f">findSeq</span> <span onmouseout="hideTip(event, 'fs108', 336)" onmouseover="showTip(event, 'fs108', 336)" class="i">query</span> <span class="o">&gt;</span><span class="o">&gt;</span> <span onmouseout="hideTip(event, 'fs80', 337)" onmouseover="showTip(event, 'fs80', 337)" class="t">Seq</span><span class="o">.</span><span onmouseout="hideTip(event, 'fs113', 338)" onmouseover="showTip(event, 'fs113', 338)" class="f">tryPick</span> <span onmouseout="hideTip(event, 'fs13', 339)" onmouseover="showTip(event, 'fs13', 339)" class="p">Some</span>
</code></pre>
<h3>Use</h3>
<p>Searching for a list of JsonValue matches with each document in a sequence is then
quite simple.  For instance, if a product data source has multiple images, the first
image is usually the main image (index 0).  Suppose we want to query
for the md5 hash of any <em>alternative</em> images (index 1+):</p>
<pre class="fssnip highlighted"><code lang="fsharp"><span class="k">let</span> <span onmouseout="hideTip(event, 'fs116', 345)" onmouseover="showTip(event, 'fs116', 345)" class="i">count</span> <span class="o">=</span>
    <span class="c">// partially applying the query runs parsing only once</span>
    <span class="c">// obtain a total count of all matches:</span>
    <span onmouseout="hideTip(event, 'fs114', 346)" onmouseover="showTip(event, 'fs114', 346)" class="i">jsonSeq</span>
    <span class="o">|&gt;</span> <span onmouseout="hideTip(event, 'fs80', 347)" onmouseover="showTip(event, 'fs80', 347)" class="t">Seq</span><span class="o">.</span><span onmouseout="hideTip(event, 'fs117', 348)" onmouseover="showTip(event, 'fs117', 348)" class="f">map</span> (<span onmouseout="hideTip(event, 'fs115', 349)" onmouseover="showTip(event, 'fs115', 349)" class="t">JsonValue</span><span class="o">.</span><span onmouseout="hideTip(event, 'fs107', 350)" onmouseover="showTip(event, 'fs107', 350)" class="f">findList</span> <span class="s">&quot;$.source.data.images[1:].md5&quot;</span> <span class="o">&gt;</span><span class="o">&gt;</span> <span onmouseout="hideTip(event, 'fs61', 351)" onmouseover="showTip(event, 'fs61', 351)" class="t">List</span><span class="o">.</span><span onmouseout="hideTip(event, 'fs118', 352)" onmouseover="showTip(event, 'fs118', 352)" class="f">length</span>)
    <span class="o">|&gt;</span> <span onmouseout="hideTip(event, 'fs80', 353)" onmouseover="showTip(event, 'fs80', 353)" class="t">Seq</span><span class="o">.</span><span onmouseout="hideTip(event, 'fs119', 354)" onmouseover="showTip(event, 'fs119', 354)" class="f">sum</span>
</code></pre>
<h3>Correctness</h3>
<p><em>What does JsonPath support that this solution does not?</em></p>
<p>In particular, you might wonder about custom expression support. For instance,
filtering books with <code>$.books[?(@.price&lt;10)]</code>, or <code>$.books[?(@.Name == 'Json for Dummies')]</code>.</p>
<p>These can definitely be added -- and would make for a nice follow-up post!</p>
<p><em>Is this implementation correct?</em></p>
<p><a href="https://git.io/v1j6c">Unit Tests</a> have been created, encompassing a wide variety of cases.
Special attention was paid to array slice and literal operations, in addition to some
of the more unusual cases: long <a href="https://en.wikipedia.org/wiki/Cons#Lists">cons-lists</a>,
for instance.</p>
<p>In many cases, implementations of JsonPath disagree! ;)</p>
<h3>Performance</h3>
<p>For a comparison with Newtonsoft's Json.NET library, several queries were applied
to an in-memory dataset of 100,000 products of varying complexity and size.  In particular:</p>
<ul>
<li><code>$.no.match</code> - evaluates early termination in the event no match exists</li>
<li><code>$.source.data.images[1:].md5</code> - multiple elements of an array at a <em>specific path</em></li>
<li><code>$..sku_id</code> - occurs many times in the document at varying locations</li>
<li><code>$..title</code> - similar to <code>sku_id</code>, but appears in records with many properties</li>
</ul>
<p>Measurements are taken starting from either string or JsonValue.  In particular,
the <code>JsonValue.find</code> functions need to prepend <code>JsonValue.Parse &gt;&gt;</code> when reading a
sequence of strings.  In the opposite direction, <code>JsonValue</code> is converted to string with
the <code>JsonSaveOptions.DisableFormatting</code> flag applied before using Newtonsoft's Json.NET.</p>
<p>The intention is to show which library might perform better given data in a particular
format.</p>
<img src="benchmarks.png" class="post-slide" alt="Comparison w/Newtonsoft.Json"/>
<p>In the results above, one takeaway is quite clear: if your data is already in JsonValue format,
we've created a mechanism that can query paths quite quickly.  Using operations that have to
query the entire document have very predictable performance.  However, querying well defined
paths can definitely speed up the search.</p>
<p>By contrast, if you're operating on Json data exclusively in string format, <em>you should
probably stay with Newtonsoft.Json</em>.</p>
<h3>Summary</h3>

<div class="tip" id="fs1">namespace System</div>
<div class="tip" id="fs2">namespace System.Text</div>
<div class="tip" id="fs3">namespace System.Text.RegularExpressions</div>
<div class="tip" id="fs4">Multiple items<br />namespace FSharp<br /><br />--------------------<br />namespace Microsoft.FSharp</div>
<div class="tip" id="fs5">Multiple items<br />namespace FSharp.Data<br /><br />--------------------<br />namespace Microsoft.FSharp.Data</div>
<div class="tip" id="fs6">Multiple items<br />type CompilationRepresentationAttribute =<br />&#160;&#160;inherit Attribute<br />&#160;&#160;new : flags:CompilationRepresentationFlags -&gt; CompilationRepresentationAttribute<br />&#160;&#160;member Flags : CompilationRepresentationFlags<br /><br />Full name: Microsoft.FSharp.Core.CompilationRepresentationAttribute<br /><br />--------------------<br />new : flags:CompilationRepresentationFlags -&gt; CompilationRepresentationAttribute</div>
<div class="tip" id="fs7">type CompilationRepresentationFlags =<br />&#160;&#160;|  None  =  0<br />&#160;&#160;|  Static  =  1<br />&#160;&#160;|  Instance  =  2<br />&#160;&#160;|  ModuleSuffix  =  4<br />&#160;&#160;|  UseNullAsTrueValue  =  8<br />&#160;&#160;|  Event  =  16<br /><br />Full name: Microsoft.FSharp.Core.CompilationRepresentationFlags</div>
<div class="tip" id="fs8">CompilationRepresentationFlags.ModuleSuffix: CompilationRepresentationFlags = 4</div>
<div class="tip" id="fs9">type JsonValue =<br />&#160;&#160;| String of string<br />&#160;&#160;| Number of decimal<br />&#160;&#160;| Float of float<br />&#160;&#160;| Record of properties: (string * JsonValue) []<br />&#160;&#160;| Array of elements: JsonValue []<br />&#160;&#160;| Boolean of bool<br />&#160;&#160;| Null<br />&#160;&#160;member Request : uri:string * ?httpMethod:string * ?headers:seq&lt;string * string&gt; -&gt; HttpResponse<br />&#160;&#160;member RequestAsync : uri:string * ?httpMethod:string * ?headers:seq&lt;string * string&gt; -&gt; Async&lt;HttpResponse&gt;<br />&#160;&#160;override ToString : unit -&gt; string<br />&#160;&#160;member ToString : saveOptions:JsonSaveOptions -&gt; string<br />&#160;&#160;member WriteTo : w:TextWriter * saveOptions:JsonSaveOptions -&gt; unit<br />&#160;&#160;static member AsyncLoad : uri:string * ?cultureInfo:CultureInfo -&gt; Async&lt;JsonValue&gt;<br />&#160;&#160;static member private JsonStringEncodeTo : w:TextWriter -&gt; value:string -&gt; unit<br />&#160;&#160;static member Load : uri:string * ?cultureInfo:CultureInfo -&gt; JsonValue<br />&#160;&#160;static member Load : reader:TextReader * ?cultureInfo:CultureInfo -&gt; JsonValue<br />&#160;&#160;static member Load : stream:Stream * ?cultureInfo:CultureInfo -&gt; JsonValue<br />&#160;&#160;static member Parse : text:string * ?cultureInfo:CultureInfo -&gt; JsonValue<br />&#160;&#160;static member ParseMultiple : text:string * ?cultureInfo:CultureInfo -&gt; seq&lt;JsonValue&gt;<br />&#160;&#160;static member ParseSample : text:string * ?cultureInfo:CultureInfo -&gt; JsonValue<br /><br />Full name: FSharp.Data.JsonValue</div>
<div class="tip" id="fs10">val private valueOr : defaultValue:int -&gt; _arg1:int option -&gt; int<br /><br />Full name: 2016-12-15-jsonpath-queries-using-fsharpdata.JsonValueModule.valueOr</div>
<div class="tip" id="fs11">val defaultValue : int</div>
<div class="tip" id="fs12">Multiple items<br />val int : value:&#39;T -&gt; int (requires member op_Explicit)<br /><br />Full name: Microsoft.FSharp.Core.Operators.int<br /><br />--------------------<br />type int = int32<br /><br />Full name: Microsoft.FSharp.Core.int<br /><br />--------------------<br />type int&lt;&#39;Measure&gt; = int<br /><br />Full name: Microsoft.FSharp.Core.int&lt;_&gt;</div>
<div class="tip" id="fs13">union case Option.Some: Value: &#39;T -&gt; Option&lt;&#39;T&gt;</div>
<div class="tip" id="fs14">val x : int</div>
<div class="tip" id="fs15">union case Option.None: Option&lt;&#39;T&gt;</div>
<div class="tip" id="fs16">type Query = string<br /><br />Full name: 2016-12-15-jsonpath-queries-using-fsharpdata.JsonValueModule.Query</div>
<div class="tip" id="fs17">Multiple items<br />val string : value:&#39;T -&gt; string<br /><br />Full name: Microsoft.FSharp.Core.Operators.string<br /><br />--------------------<br />type string = String<br /><br />Full name: Microsoft.FSharp.Core.string</div>
<div class="tip" id="fs18">type Levels = JsonValue.Query.Level list<br /><br />Full name: 2016-12-15-jsonpath-queries-using-fsharpdata.JsonValueModule.QueryModule.Levels</div>
<div class="tip" id="fs19">type Level = JsonValue.Query.Scope * JsonValue.Query.Type<br /><br />Full name: 2016-12-15-jsonpath-queries-using-fsharpdata.JsonValueModule.QueryModule.Level</div>
<div class="tip" id="fs20">type &#39;T list = List&lt;&#39;T&gt;<br /><br />Full name: Microsoft.FSharp.Collections.list&lt;_&gt;</div>
<div class="tip" id="fs21">type Scope =<br />&#160;&#160;| Any<br />&#160;&#160;| Exact<br /><br />Full name: 2016-12-15-jsonpath-queries-using-fsharpdata.JsonValueModule.QueryModule.Scope</div>
<div class="tip" id="fs22">type Type =<br />&#160;&#160;| Property of Name<br />&#160;&#160;| Array of Index<br /><br />Full name: 2016-12-15-jsonpath-queries-using-fsharpdata.JsonValueModule.QueryModule.Type</div>
<div class="tip" id="fs23">union case JsonValue.Query.Type.Property: JsonValue.Query.Name -&gt; JsonValue.Query.Type</div>
<div class="tip" id="fs24">type Name = string<br /><br />Full name: 2016-12-15-jsonpath-queries-using-fsharpdata.JsonValueModule.QueryModule.Name</div>
<div class="tip" id="fs25">Multiple items<br />union case JsonValue.Query.Type.Array: JsonValue.Query.Index -&gt; JsonValue.Query.Type<br /><br />--------------------<br />type Array =<br />&#160;&#160;member Clone : unit -&gt; obj<br />&#160;&#160;member CopyTo : array:Array * index:int -&gt; unit + 1 overload<br />&#160;&#160;member GetEnumerator : unit -&gt; IEnumerator<br />&#160;&#160;member GetLength : dimension:int -&gt; int<br />&#160;&#160;member GetLongLength : dimension:int -&gt; int64<br />&#160;&#160;member GetLowerBound : dimension:int -&gt; int<br />&#160;&#160;member GetUpperBound : dimension:int -&gt; int<br />&#160;&#160;member GetValue : [&lt;ParamArray&gt;] indices:int[] -&gt; obj + 7 overloads<br />&#160;&#160;member Initialize : unit -&gt; unit<br />&#160;&#160;member IsFixedSize : bool<br />&#160;&#160;...<br /><br />Full name: System.Array</div>
<div class="tip" id="fs26">type Index =<br />&#160;&#160;| Expression of string<br />&#160;&#160;| Wildcard<br />&#160;&#160;| Slice of start: int option * finish: int option * step: int<br />&#160;&#160;| Literal of int list<br /><br />Full name: 2016-12-15-jsonpath-queries-using-fsharpdata.JsonValueModule.QueryModule.Index</div>
<div class="tip" id="fs27">union case JsonValue.Query.Scope.Any: JsonValue.Query.Scope</div>
<div class="tip" id="fs28">union case JsonValue.Query.Scope.Exact: JsonValue.Query.Scope</div>
<div class="tip" id="fs29">union case JsonValue.Query.Index.Expression: string -&gt; JsonValue.Query.Index</div>
<div class="tip" id="fs30">union case JsonValue.Query.Index.Wildcard: JsonValue.Query.Index</div>
<div class="tip" id="fs31">union case JsonValue.Query.Index.Slice: start: int option * finish: int option * step: int -&gt; JsonValue.Query.Index</div>
<div class="tip" id="fs32">type &#39;T option = Option&lt;&#39;T&gt;<br /><br />Full name: Microsoft.FSharp.Core.option&lt;_&gt;</div>
<div class="tip" id="fs33">Multiple items<br />union case JsonValue.Query.Index.Literal: int list -&gt; JsonValue.Query.Index<br /><br />--------------------<br />type LiteralAttribute =<br />&#160;&#160;inherit Attribute<br />&#160;&#160;new : unit -&gt; LiteralAttribute<br /><br />Full name: Microsoft.FSharp.Core.LiteralAttribute<br /><br />--------------------<br />new : unit -&gt; LiteralAttribute</div>
<div class="tip" id="fs34">val levelsFor : path:JsonValue.Query -&gt; JsonValue.Query.Levels<br /><br />Full name: 2016-12-15-jsonpath-queries-using-fsharpdata.JsonValueModule.QueryModule.levelsFor</div>
<div class="tip" id="fs35">val path : JsonValue.Query</div>
<div class="tip" id="fs36">module Array<br /><br />from Microsoft.FSharp.Collections</div>
<div class="tip" id="fs37">Multiple items<br />type LiteralAttribute =<br />&#160;&#160;inherit Attribute<br />&#160;&#160;new : unit -&gt; LiteralAttribute<br /><br />Full name: Microsoft.FSharp.Core.LiteralAttribute<br /><br />--------------------<br />new : unit -&gt; LiteralAttribute</div>
<div class="tip" id="fs38">type Automata = JsonValue.Pattern.Automaton list<br /><br />Full name: 2016-12-15-jsonpath-queries-using-fsharpdata.JsonValueModule.Pattern.Automata</div>
<div class="tip" id="fs39">Multiple items<br />union case JsonValue.Pattern.State.Automaton: JsonValue.Pattern.Automaton -&gt; JsonValue.Pattern.State<br /><br />--------------------<br />type Automaton = JsonValue.Pattern.Input -&gt; JsonValue.Pattern.State list<br /><br />Full name: 2016-12-15-jsonpath-queries-using-fsharpdata.JsonValueModule.Pattern.Automaton</div>
<div class="tip" id="fs40">type Input =<br />&#160;&#160;| Property of Name<br />&#160;&#160;| Array of index: int * length: int<br /><br />Full name: 2016-12-15-jsonpath-queries-using-fsharpdata.JsonValueModule.Pattern.Input</div>
<div class="tip" id="fs41">type State =<br />&#160;&#160;| Match<br />&#160;&#160;| Automaton of Automaton<br /><br />Full name: 2016-12-15-jsonpath-queries-using-fsharpdata.JsonValueModule.Pattern.State</div>
<div class="tip" id="fs42">Multiple items<br />union case JsonValue.Pattern.State.Match: JsonValue.Pattern.State<br /><br />--------------------<br />type Match =<br />&#160;&#160;inherit Group<br />&#160;&#160;member Groups : GroupCollection<br />&#160;&#160;member NextMatch : unit -&gt; Match<br />&#160;&#160;member Result : replacement:string -&gt; string<br />&#160;&#160;static member Empty : Match<br />&#160;&#160;static member Synchronized : inner:Match -&gt; Match<br /><br />Full name: System.Text.RegularExpressions.Match</div>
<div class="tip" id="fs43">union case JsonValue.Pattern.Input.Property: JsonValue.Query.Name -&gt; JsonValue.Pattern.Input</div>
<div class="tip" id="fs44">Multiple items<br />module Query<br /><br />from 2016-12-15-jsonpath-queries-using-fsharpdata.JsonValueModule<br /><br />--------------------<br />type Query = string<br /><br />Full name: 2016-12-15-jsonpath-queries-using-fsharpdata.JsonValueModule.Query</div>
<div class="tip" id="fs45">Multiple items<br />union case JsonValue.Pattern.Input.Array: index: int * length: int -&gt; JsonValue.Pattern.Input<br /><br />--------------------<br />type Array =<br />&#160;&#160;member Clone : unit -&gt; obj<br />&#160;&#160;member CopyTo : array:Array * index:int -&gt; unit + 1 overload<br />&#160;&#160;member GetEnumerator : unit -&gt; IEnumerator<br />&#160;&#160;member GetLength : dimension:int -&gt; int<br />&#160;&#160;member GetLongLength : dimension:int -&gt; int64<br />&#160;&#160;member GetLowerBound : dimension:int -&gt; int<br />&#160;&#160;member GetUpperBound : dimension:int -&gt; int<br />&#160;&#160;member GetValue : [&lt;ParamArray&gt;] indices:int[] -&gt; obj + 7 overloads<br />&#160;&#160;member Initialize : unit -&gt; unit<br />&#160;&#160;member IsFixedSize : bool<br />&#160;&#160;...<br /><br />Full name: System.Array</div>
<div class="tip" id="fs46">val transition : levels:JsonValue.Query.Levels -&gt; JsonValue.Pattern.Automaton<br /><br />Full name: 2016-12-15-jsonpath-queries-using-fsharpdata.JsonValueModule.Pattern.transition</div>
<div class="tip" id="fs47">val levels : JsonValue.Query.Levels</div>
<div class="tip" id="fs48">val s : JsonValue.Query.Scope</div>
<div class="tip" id="fs49">val n : JsonValue.Query.Name</div>
<div class="tip" id="fs50">val tail : JsonValue.Query.Level list</div>
<div class="tip" id="fs51">union case JsonValue.Pattern.Input.Array: index: int * length: int -&gt; JsonValue.Pattern.Input</div>
<div class="tip" id="fs52">val name : JsonValue.Query.Name</div>
<div class="tip" id="fs53">val x : JsonValue.Query.Name</div>
<div class="tip" id="fs54">val xs : JsonValue.Query.Level list</div>
<div class="tip" id="fs55">union case JsonValue.Query.Type.Array: JsonValue.Query.Index -&gt; JsonValue.Query.Type</div>
<div class="tip" id="fs56">val i : JsonValue.Query.Index</div>
<div class="tip" id="fs57">val index : int</div>
<div class="tip" id="fs58">val length : int</div>
<div class="tip" id="fs59">union case JsonValue.Query.Index.Literal: int list -&gt; JsonValue.Query.Index</div>
<div class="tip" id="fs60">val xs : int list</div>
<div class="tip" id="fs61">Multiple items<br />module List<br /><br />from Microsoft.FSharp.Collections<br /><br />--------------------<br />type List&lt;&#39;T&gt; =<br />&#160;&#160;| ( [] )<br />&#160;&#160;| ( :: ) of Head: &#39;T * Tail: &#39;T list<br />&#160;&#160;interface IEnumerable<br />&#160;&#160;interface IEnumerable&lt;&#39;T&gt;<br />&#160;&#160;member GetSlice : startIndex:int option * endIndex:int option -&gt; &#39;T list<br />&#160;&#160;member Head : &#39;T<br />&#160;&#160;member IsEmpty : bool<br />&#160;&#160;member Item : index:int -&gt; &#39;T with get<br />&#160;&#160;member Length : int<br />&#160;&#160;member Tail : &#39;T list<br />&#160;&#160;static member Cons : head:&#39;T * tail:&#39;T list -&gt; &#39;T list<br />&#160;&#160;static member Empty : &#39;T list<br /><br />Full name: Microsoft.FSharp.Collections.List&lt;_&gt;</div>
<div class="tip" id="fs62">val map : mapping:(&#39;T -&gt; &#39;U) -&gt; list:&#39;T list -&gt; &#39;U list<br /><br />Full name: Microsoft.FSharp.Collections.List.map</div>
<div class="tip" id="fs63">val exists : predicate:(&#39;T -&gt; bool) -&gt; list:&#39;T list -&gt; bool<br /><br />Full name: Microsoft.FSharp.Collections.List.exists</div>
<div class="tip" id="fs64">val start : int option</div>
<div class="tip" id="fs65">val finish : int option</div>
<div class="tip" id="fs66">val step : int</div>
<div class="tip" id="fs67">val start : int</div>
<div class="tip" id="fs68">val finish : int</div>
<div class="tip" id="fs69">val create : levels:JsonValue.Query.Levels -&gt; JsonValue.Pattern.State<br /><br />Full name: 2016-12-15-jsonpath-queries-using-fsharpdata.JsonValueModule.Pattern.create</div>
<div class="tip" id="fs70">val findSeq : (JsonValue.Query -&gt; JsonValue -&gt; seq&lt;JsonValue&gt;)<br /><br />Full name: 2016-12-15-jsonpath-queries-using-fsharpdata.JsonValueModule.findSeq</div>
<div class="tip" id="fs71">val partition : (JsonValue.Pattern.State list -&gt; bool * JsonValue.Pattern.Automaton list)</div>
<div class="tip" id="fs72">val fold : folder:(&#39;State -&gt; &#39;T -&gt; &#39;State) -&gt; state:&#39;State -&gt; list:&#39;T list -&gt; &#39;State<br /><br />Full name: Microsoft.FSharp.Collections.List.fold</div>
<div class="tip" id="fs73">val matches : bool</div>
<div class="tip" id="fs74">val automata : JsonValue.Pattern.Automaton list</div>
<div class="tip" id="fs75">module Pattern<br /><br />from 2016-12-15-jsonpath-queries-using-fsharpdata.JsonValueModule</div>
<div class="tip" id="fs76">union case JsonValue.Pattern.State.Match: JsonValue.Pattern.State</div>
<div class="tip" id="fs77">union case JsonValue.Pattern.State.Automaton: JsonValue.Pattern.Automaton -&gt; JsonValue.Pattern.State</div>
<div class="tip" id="fs78">val x : JsonValue.Pattern.Automaton</div>
<div class="tip" id="fs79">val recurse : ((JsonValue.Pattern.State list * JsonValue) list -&gt; seq&lt;JsonValue&gt;)</div>
<div class="tip" id="fs80">module Seq<br /><br />from Microsoft.FSharp.Collections</div>
<div class="tip" id="fs81">val empty&lt;&#39;T&gt; : seq&lt;&#39;T&gt;<br /><br />Full name: Microsoft.FSharp.Collections.Seq.empty</div>
<div class="tip" id="fs82">val states : JsonValue.Pattern.State list</div>
<div class="tip" id="fs83">val value : JsonValue</div>
<div class="tip" id="fs84">val positions : (JsonValue.Pattern.State list * JsonValue) list</div>
<div class="tip" id="fs85">Multiple items<br />val seq : sequence:seq&lt;&#39;T&gt; -&gt; seq&lt;&#39;T&gt;<br /><br />Full name: Microsoft.FSharp.Core.Operators.seq<br /><br />--------------------<br />type seq&lt;&#39;T&gt; = Collections.Generic.IEnumerable&lt;&#39;T&gt;<br /><br />Full name: Microsoft.FSharp.Collections.seq&lt;_&gt;</div>
<div class="tip" id="fs86">val hasMatch : bool</div>
<div class="tip" id="fs87">union case JsonValue.Record: properties: (string * JsonValue) [] -&gt; JsonValue</div>
<div class="tip" id="fs88">val xs : (string * JsonValue) []</div>
<div class="tip" id="fs89">type Array =<br />&#160;&#160;member Clone : unit -&gt; obj<br />&#160;&#160;member CopyTo : array:Array * index:int -&gt; unit + 1 overload<br />&#160;&#160;member GetEnumerator : unit -&gt; IEnumerator<br />&#160;&#160;member GetLength : dimension:int -&gt; int<br />&#160;&#160;member GetLongLength : dimension:int -&gt; int64<br />&#160;&#160;member GetLowerBound : dimension:int -&gt; int<br />&#160;&#160;member GetUpperBound : dimension:int -&gt; int<br />&#160;&#160;member GetValue : [&lt;ParamArray&gt;] indices:int[] -&gt; obj + 7 overloads<br />&#160;&#160;member Initialize : unit -&gt; unit<br />&#160;&#160;member IsFixedSize : bool<br />&#160;&#160;...<br /><br />Full name: System.Array</div>
<div class="tip" id="fs90">val map : mapping:(&#39;T -&gt; &#39;U) -&gt; array:&#39;T [] -&gt; &#39;U []<br /><br />Full name: Microsoft.FSharp.Collections.Array.map</div>
<div class="tip" id="fs91">val name : string</div>
<div class="tip" id="fs92">val json : JsonValue</div>
<div class="tip" id="fs93">val collect : mapping:(&#39;T -&gt; &#39;U list) -&gt; list:&#39;T list -&gt; &#39;U list<br /><br />Full name: Microsoft.FSharp.Collections.List.collect</div>
<div class="tip" id="fs94">val a : JsonValue.Pattern.Automaton</div>
<div class="tip" id="fs95">union case JsonValue.Array: elements: JsonValue [] -&gt; JsonValue</div>
<div class="tip" id="fs96">val xs : JsonValue []</div>
<div class="tip" id="fs97">val mapi : mapping:(int -&gt; &#39;T -&gt; &#39;U) -&gt; array:&#39;T [] -&gt; &#39;U []<br /><br />Full name: Microsoft.FSharp.Collections.Array.mapi</div>
<div class="tip" id="fs98">val i : int</div>
<div class="tip" id="fs99">property Array.Length: int</div>
<div class="tip" id="fs100">val empty&lt;&#39;T&gt; : &#39;T []<br /><br />Full name: Microsoft.FSharp.Collections.Array.empty</div>
<div class="tip" id="fs101">val foldBack : folder:(&#39;T -&gt; &#39;State -&gt; &#39;State) -&gt; array:&#39;T [] -&gt; state:&#39;State -&gt; &#39;State<br /><br />Full name: Microsoft.FSharp.Collections.Array.foldBack</div>
<div class="tip" id="fs102">val x : JsonValue.Pattern.State list * JsonValue</div>
<div class="tip" id="fs103">val xs : (JsonValue.Pattern.State list * JsonValue) list</div>
<div class="tip" id="fs104">val singleton : value:&#39;T -&gt; seq&lt;&#39;T&gt;<br /><br />Full name: Microsoft.FSharp.Collections.Seq.singleton</div>
<div class="tip" id="fs105">val levels : JsonValue.Query.Level list</div>
<div class="tip" id="fs106">val start : JsonValue.Pattern.State</div>
<div class="tip" id="fs107">val findList : query:JsonValue.Query -&gt; (JsonValue -&gt; JsonValue list)<br /><br />Full name: 2016-12-15-jsonpath-queries-using-fsharpdata.JsonValueModule.findList</div>
<div class="tip" id="fs108">val query : JsonValue.Query</div>
<div class="tip" id="fs109">val toList : source:seq&lt;&#39;T&gt; -&gt; &#39;T list<br /><br />Full name: Microsoft.FSharp.Collections.Seq.toList</div>
<div class="tip" id="fs110">val find : query:JsonValue.Query -&gt; (JsonValue -&gt; JsonValue)<br /><br />Full name: 2016-12-15-jsonpath-queries-using-fsharpdata.JsonValueModule.find</div>
<div class="tip" id="fs111">val head : source:seq&lt;&#39;T&gt; -&gt; &#39;T<br /><br />Full name: Microsoft.FSharp.Collections.Seq.head</div>
<div class="tip" id="fs112">val tryFind : query:JsonValue.Query -&gt; (JsonValue -&gt; JsonValue option)<br /><br />Full name: 2016-12-15-jsonpath-queries-using-fsharpdata.JsonValueModule.tryFind</div>
<div class="tip" id="fs113">val tryPick : chooser:(&#39;T -&gt; &#39;U option) -&gt; source:seq&lt;&#39;T&gt; -&gt; &#39;U option<br /><br />Full name: Microsoft.FSharp.Collections.Seq.tryPick</div>
<div class="tip" id="fs114">val jsonSeq : seq&lt;JsonValue&gt;<br /><br />Full name: 2016-12-15-jsonpath-queries-using-fsharpdata.jsonSeq</div>
<div class="tip" id="fs115">Multiple items<br />module JsonValue<br /><br />from 2016-12-15-jsonpath-queries-using-fsharpdata<br /><br />--------------------<br />type JsonValue =<br />&#160;&#160;| String of string<br />&#160;&#160;| Number of decimal<br />&#160;&#160;| Float of float<br />&#160;&#160;| Record of properties: (string * JsonValue) []<br />&#160;&#160;| Array of elements: JsonValue []<br />&#160;&#160;| Boolean of bool<br />&#160;&#160;| Null<br />&#160;&#160;member Request : uri:string * ?httpMethod:string * ?headers:seq&lt;string * string&gt; -&gt; HttpResponse<br />&#160;&#160;member RequestAsync : uri:string * ?httpMethod:string * ?headers:seq&lt;string * string&gt; -&gt; Async&lt;HttpResponse&gt;<br />&#160;&#160;override ToString : unit -&gt; string<br />&#160;&#160;member ToString : saveOptions:JsonSaveOptions -&gt; string<br />&#160;&#160;member WriteTo : w:TextWriter * saveOptions:JsonSaveOptions -&gt; unit<br />&#160;&#160;static member AsyncLoad : uri:string * ?cultureInfo:CultureInfo -&gt; Async&lt;JsonValue&gt;<br />&#160;&#160;static member private JsonStringEncodeTo : w:TextWriter -&gt; value:string -&gt; unit<br />&#160;&#160;static member Load : uri:string * ?cultureInfo:CultureInfo -&gt; JsonValue<br />&#160;&#160;static member Load : reader:TextReader * ?cultureInfo:CultureInfo -&gt; JsonValue<br />&#160;&#160;static member Load : stream:Stream * ?cultureInfo:CultureInfo -&gt; JsonValue<br />&#160;&#160;static member Parse : text:string * ?cultureInfo:CultureInfo -&gt; JsonValue<br />&#160;&#160;static member ParseMultiple : text:string * ?cultureInfo:CultureInfo -&gt; seq&lt;JsonValue&gt;<br />&#160;&#160;static member ParseSample : text:string * ?cultureInfo:CultureInfo -&gt; JsonValue<br /><br />Full name: FSharp.Data.JsonValue</div>
<div class="tip" id="fs116">val count : int<br /><br />Full name: 2016-12-15-jsonpath-queries-using-fsharpdata.count</div>
<div class="tip" id="fs117">val map : mapping:(&#39;T -&gt; &#39;U) -&gt; source:seq&lt;&#39;T&gt; -&gt; seq&lt;&#39;U&gt;<br /><br />Full name: Microsoft.FSharp.Collections.Seq.map</div>
<div class="tip" id="fs118">val length : list:&#39;T list -&gt; int<br /><br />Full name: Microsoft.FSharp.Collections.List.length</div>
<div class="tip" id="fs119">val sum : source:seq&lt;&#39;T&gt; -&gt; &#39;T (requires member ( + ) and member get_Zero)<br /><br />Full name: Microsoft.FSharp.Collections.Seq.sum</div>
